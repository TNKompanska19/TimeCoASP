@{
    var events = ViewData["events"] as List<CalendarEventViewModel>;
    var length = events?.Count() ?? 0;
    Layout = "~/Views/Shared/_LayoutUser.cshtml";
}

<div class="calendarContainer">
    <div id="calendar"></div>
</div>

<table id="todoTable" style="display: none;">
    @foreach (var evt in events)
    {
        <tr>
            <td>@Html.Encode(evt.Id)</td>
            <td>@Html.Encode(evt.Title)</td>
            <td>@Html.Encode(evt.StartDate)</td>
            <td>@Html.Encode(evt.EndDate)</td>
        </tr>
    }
</table>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@5.1.0/main.min.css">
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.1.0/main.min.js"></script>

<script>
    let eventsArr = loadData();
    let calendar = initCalendar();

    function loadData() {
        let eventsArr = [];

        let todoTable = document.getElementById("todoTable");
        let trElem = todoTable.getElementsByTagName("tr");

        for (let tr of trElem) {
            let tdElems = tr.getElementsByTagName("td");
            let eventObj = {
                id: tdElems[0].innerText,
                title: tdElems[1].innerText,
                start: tdElems[2].innerText,
                end: tdElems[3].innerText // Add end date
            }

            eventsArr.push(eventObj);
        }

        return eventsArr;
    }

    function getColorForEventTitle(title) {
        // Customize this function to map titles to specific colors
        if (title === 'First') {
            return '#4287f5'; // Change this to your desired color
        } else if (title === 'Second') {
            return '#9042f5'; // Change this to your desired color
        } else if (title === 'Vacation') {
            return '#8073de'; // Change this to your desired color
        } else {
            return '#cd86f0'; // Default color
        }
    }

    function initCalendar() {
        var calendarEl = document.getElementById('calendar');

        let calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            headerToolbar: {
                left: 'prev,next',
                center: 'title',
                right: 'today'
            },
            events: eventsArr,
            eventContent: function (arg) {
                return {
                    html: '<div class="fc-content" style="background-color: ' + getColorForEventTitle(arg.event.title) + ';">' +
                        '<span class="fc-title">' + arg.event.title + '</span>' +
                        '</div>',
                };
            }
        });

        calendar.render();
        calendar.setOption('height', 750);
        return calendar;
    }
</script>
