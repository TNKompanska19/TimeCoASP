@{
    var events = ViewData["events"] as IEnumerable<TimeCo.Service.Models.ScheduleDTO>;
    var length = events?.Count() ?? 0;
}

<div class="calendarContainer">
    <div id="calendar"></div>
</div>

<table id="todoTable">
    @for (int i = 0; i < length; i++)
    {
        <tr>
            <td>@Html.Encode(events.ElementAt(i).Id)</td>
            <td>@Html.Encode(events.ElementAt(i).Shift)</td>
            <td>@Html.Encode(events.ElementAt(i).StartDate)</td>
        </tr>
    }
</table>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@5.1.0/main.min.css">
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.1.0/main.min.js"></script>

<style>
    /* Hide the table */
    #todoTable {
        display: none;
    }

    /* Style to prevent digits and week names from looking like links */
    .fc-day-number,
    .fc-day-header,
    .fc-col-header-cell-cushion,
    .fc-daygrid-day-number {
        cursor: default;
        text-decoration: none;
        color: inherit;
    }

    /* Style to prevent events from looking like links */
    .fc-event {
        cursor: default;
        text-decoration: none;
        color: inherit;
    }

</style>

<script>
    let eventsArr = loadData();
    let calendar = initCalendar();

    function loadData() {
        let eventsArr = [];

        let todoTable = document.getElementById("todoTable");
        let trElem = todoTable.getElementsByTagName("tr");

        for (let tr of trElem) {
            let tdElems = tr.getElementsByTagName("td");
            let eventObj = {
                id: tdElems[0].innerText,
                title: tdElems[1].innerText,
                start: tdElems[2].innerText,
            }

            eventsArr.push(eventObj);
        }

        return eventsArr;
    }

    function getColorForEventTitle(title) {
        // Customize this function to map titles to specific colors
        if (title === 'FirstShift') {
            return '#4287f5'; // Change this to your desired color
        } else if (title === 'SecondShift') {
            return '#9042f5'; // Change this to your desired color
        } else {
            return '#cd86f0'; // Default color
        }
    }

    function initCalendar() {
        var calendarEl = document.getElementById('calendar');

        let calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            headerToolbar: {
                left: 'prev,next',
                center: 'title',
                right: 'today'
            },
            events: eventsArr,
            eventContent: function (arg) {
                return {
                    html: '<div class="fc-content" style="background-color: ' + getColorForEventTitle(arg.event.title) + ';">' +
                        '<span class="fc-title">' + arg.event.title + '</span>' +
                        '</div>',
                };
            }
        });

        calendar.render();
        calendar.setOption('height', 750);
        return calendar;
    }
</script>
